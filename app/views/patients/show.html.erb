<% provide(:title, "Patient Dashboard") %>

<div class="container patient-profile">
    <div class="main">
      <div class="avatar">
        <img src="https://cdn0.vox-cdn.com/images/verge/default-avatar.v9899025.gif">
      </div>
      <div class="dynamic button">
        <% if therapist_logged_in? %>
          <% if connection_request_pending? %>
            <%= form_tag({controller: "patient_therapist_relationships", action: "update"}, method: "post") do %>
              <%= hidden_field_tag 'patient_id', params[:patient_id] %>
              <%= hidden_field_tag 'therapist_id', current_therapist.id %>
              <%= hidden_field_tag 'status', "accept" %>
              <%= submit_tag "Accept" %>
            <% end %>

            <!-- FOR DANIEL: This form should be a dialog that opens after the user clicks a Deny button -->

            <%= form_tag({controller: "patient_therapist_relationships", action: "update"}, method: "post") do %>
              <%= hidden_field_tag 'patient_id', params[:patient_id] %>
              <%= hidden_field_tag 'therapist_id', current_therapist.id %>
              <%= hidden_field_tag 'status', "deny" %>
              <%= text_area_tag 'comment' %>
              <%= submit_tag "Send Response" %>
            <% end %>
          <% elsif connection_accepted %>
            <%= link_to show_conversation_path(@message) do %>
              Send Message
            <% end %>
          <% end %>
        <% end %>
        <% if patient_logged_in? %>
          <%= link_to inbox_path(patient_id: @patient.id) do %>
            Inbox
          <% end %>
        <% end %>
      </div>

      <div class="basic">
        <p><%= @patient.name %></p>
        <p><%= @patient.phone %></p>
        <p><%= @patient.email %></p>
        <p><%= @patient.zipcode %></p>
        <p><%= @patient.gender %></p>
      </div>
      <div class="info">
        <p>
          <strong>Former Religion:</strong>
          <%= @patient.former_religion %>
        </p>
        <p>
          <strong>About you:</strong>
          <%= @patient.description %>
        </p>
      </div>
      <div class="conversations">
        <% @patient.conversations.each do |conversation| %>
          <p><%= link_to "Conversation with Therapist ##{conversation.therapist.id}", conversation_path(patient_id: @patient.id, therapist_id: conversation.therapist.id, conversation_id: conversation.id) %></p>
        <% end %>
      </div>
  </div>
  <div class="search">

    <h2>Therapists Near You</h2>
    <% @results.each do |t| %>
      <p>Therapist ID: <%= t.id %></p>
      <p>Description: <%= t.description %></p>
      <p>State: <%= t.state %></p>
      <p><%= button_to 'Send Contact Request', new_connection_request_path(patient_id: session[:patient_id], therapist_id: t.id) %></p>
    <% end %>

  </div>
</div>
